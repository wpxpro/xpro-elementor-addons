"use strict";function _typeof(a){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}!function(c,d,b){var a={Views:{},Models:{},Collections:{},Behaviors:{},Layout:null,Manager:null};a.Models.Template=Backbone.Model.extend({defaults:{template_id:0,title:"",type:"",thumbnail:"",url:"",tags:[],isPro:!1}}),a.Collections.Template=Backbone.Collection.extend({model:a.Models.Template}),a.Behaviors.InsertTemplate=Marionette.Behavior.extend({ui:{insertButton:".xproTemplateLibrary__insert-button"},events:{"click @ui.insertButton":"onInsertButtonClick"},onInsertButtonClick:function(){b.library.insertTemplate({model:this.view.model})}}),a.Views.EmptyTemplateCollection=Marionette.ItemView.extend({id:"elementor-template-library-templates-empty",template:"#tmpl-xproTemplateLibrary__empty",ui:{title:".elementor-template-library-blank-title",message:".elementor-template-library-blank-message"},modesStrings:{empty:{title:"Templates Not Found",message:"Something Went Wrong Please Check"},noResults:{title:"No Result Found",message:"Sorry, but nothing matched your selection"}},getCurrentMode:function(){return b.library.getFilter("text")?"noResults":"empty"},onRender:function(){var a=this.modesStrings[this.getCurrentMode()];this.ui.title.html(a.title),this.ui.message.html(a.message)}}),a.Views.Loading=Marionette.ItemView.extend({template:"#tmpl-xproTemplateLibrary__loading",id:"xproTemplateLibrary__loading"}),a.Views.Logo=Marionette.ItemView.extend({template:"#tmpl-xproTemplateLibrary__header-logo",className:"xproTemplateLibrary__header-logo",templateHelpers:function(){return{title:this.getOption("title")}}}),a.Views.BackButton=Marionette.ItemView.extend({template:"#tmpl-xproTemplateLibrary__header-back",id:"elementor-template-library-header-preview-back",className:"xproTemplateLibrary__header-back",events:function(){return{click:"onClick"}},onClick:function(){b.library.showTemplatesView()}}),a.Views.Menu=Marionette.ItemView.extend({template:"#tmpl-xproTemplateLibrary__header-menu",id:"elementor-template-library-header-menu",className:"xproTemplateLibrary__header-menu",templateHelpers:function(){return b.library.getTabs()},ui:{menuItem:".elementor-template-library-menu-item"},events:{"click @ui.menuItem":"onMenuItemClick"},onMenuItemClick:function(a){b.library.setFilter("tags",""),b.library.setFilter("text",""),b.library.setFilter("type",a.currentTarget.dataset.tab,!0),b.library.showTemplatesView()}}),a.Views.ResponsiveMenu=Marionette.ItemView.extend({template:"#tmpl-xproTemplateLibrary__header-menu-responsive",id:"elementor-template-library-header-menu-responsive",className:"xproTemplateLibrary__header-menu-responsive",ui:{items:"> .elementor-component-tab"},events:{"click @ui.items":"onTabItemClick"},onTabItemClick:function(d){var a=c(d.currentTarget),e=a.data("tab");b.library.channels.tabs.trigger("change:device",e,a)}}),a.Views.Actions=Marionette.ItemView.extend({template:"#tmpl-xproTemplateLibrary__header-actions",id:"elementor-template-library-header-actions",ui:{sync:"#xproTemplateLibrary__header-sync i"},events:{"click @ui.sync":"onSyncClick"},onSyncClick:function(){var a=this;a.ui.sync.addClass("eicon-animation-spin"),b.library.requestLibraryData({onUpdate:function(){a.ui.sync.length&&a.ui.sync.removeClass("eicon-animation-spin"),b.library.updateBlocksView()},forceUpdate:!0,forceSync:!0})}}),a.Views.InsertWrapper=Marionette.ItemView.extend({template:"#tmpl-xproTemplateLibrary__header-insert",id:"elementor-template-library-header-preview",behaviors:{insertTemplate:{behaviorClass:a.Behaviors.InsertTemplate}}}),a.Views.Preview=Marionette.ItemView.extend({template:"#tmpl-xproTemplateLibrary__preview",className:"xproTemplateLibrary__preview",ui:function(){return{iframe:"> iframe"}},onRender:function(){this.ui.iframe.attr("src",this.getOption("url")).hide();var c=this,b=new a.Views.Loading().render();this.$el.append(b.el),this.ui.iframe.on("load",function(){c.$el.find("#xproTemplateLibrary__loading").remove(),c.ui.iframe.show()})}}),a.Views.TemplateCollection=Marionette.CompositeView.extend({template:"#tmpl-xproTemplateLibrary__templates",id:"xproTemplateLibrary__templates",className:function(){return"xproTemplateLibrary__templates xproTemplateLibrary__templates--"+b.library.getFilter("type")},childViewContainer:"#xproTemplateLibrary__templates-list",emptyView:function(){return new a.Views.EmptyTemplateCollection},ui:{templatesWindow:".xproTemplateLibrary__templates-window",textFilter:"#xproTemplateLibrary__search",tagsFilter:"#xproTemplateLibrary__filter-tags",filterBar:"#xproTemplateLibrary__toolbar-filter",counter:"#xproTemplateLibrary__toolbar-counter"},events:{"input @ui.textFilter":"onTextFilterInput","click @ui.tagsFilter li":"onTagsFilterClick"},getChildView:function(b){return a.Views.Template},initialize:function(){this.listenTo(b.library.channels.templates,"filter:change",this._renderChildren)},filter:function(d){var a=b.library.getFilterTerms(),c=!0;return _.each(a,function(a,g){var e=b.library.getFilter(g);if(e&&a.callback){var f=a.callback.call(d,e);return f||(c=!1),f}}),c},setMasonrySkin:function(){if("section"===b.library.getFilter("type")){var a=new elementorModules.utils.Masonry({container:this.$childViewContainer,items:this.$childViewContainer.children()});this.$childViewContainer.imagesLoaded(a.run.bind(a))}},onRenderCollection:function(){this.setMasonrySkin(),this.updatePerfectScrollbar(),this.setTemplatesFoundText()},setTemplatesFoundText:function(){var c=b.library.getFilter("type"),d=this.children.length,a="<b>"+d+"</b>";a+="section"===c?" block":" "+c,d>1&&(a+="s"),a+=" found",this.ui.counter.html(a)},onTextFilterInput:function(){var a=this;_.defer(function(){b.library.setFilter("text",a.ui.textFilter.val())})},onTagsFilterClick:function(e){var d=c(e.currentTarget),a=d.data("tag");b.library.setFilter("tags",a),d.addClass("active").siblings().removeClass("active"),a=a?b.library.getTags()[a]:"Filter",this.ui.filterBar.find(".xproTemplateLibrary__filter-btn").html(a+' <i class="eicon-caret-down"></i>')},updatePerfectScrollbar:function(){this.perfectScrollbar||(this.perfectScrollbar=new PerfectScrollbar(this.ui.templatesWindow[0],{suppressScrollX:!0})),this.perfectScrollbar.isRtl=!1,this.perfectScrollbar.update()},setTagsFilterHover:function(){var a=this;a.ui.filterBar.hoverIntent(function(){a.ui.tagsFilter.css("display","block"),a.ui.filterBar.find(".xproTemplateLibrary__filter-btn i").addClass("eicon-caret-down").removeClass("eicon-caret-right")},function(){a.ui.tagsFilter.css("display","none"),a.ui.filterBar.find(".xproTemplateLibrary__filter-btn i").addClass("eicon-caret-right").removeClass("eicon-caret-down")},{sensitivity:50,interval:150,timeout:100})},onRender:function(){this.setTagsFilterHover(),this.updatePerfectScrollbar()}}),a.Views.Template=Marionette.ItemView.extend({template:"#tmpl-xproTemplateLibrary__template",className:"xproTemplateLibrary__template",ui:{previewButton:".xproTemplateLibrary__preview-button, .xproTemplateLibrary__template-preview"},events:{"click @ui.previewButton":"onPreviewButtonClick"},behaviors:{insertTemplate:{behaviorClass:a.Behaviors.InsertTemplate}},onPreviewButtonClick:function(){b.library.showPreviewView(this.model)}}),a.Modal=elementorModules.common.views.modal.Layout.extend({getModalOptions:function(){return{id:"xproTemplateLibrary__modal",hide:{onOutsideClick:!1,onEscKeyPress:!0,onBackgroundClick:!1}}},getTemplateActionButton:function(a){var b="#tmpl-xproTemplateLibrary__"+(a.isPro&&0==XproElementorAddonsEditor.hasPro?"pro-button":"insert-button"),c=Marionette.TemplateCache.get(b);return Marionette.Renderer.render(c)},showLogo:function(b){this.getHeaderView().logoArea.show(new a.Views.Logo(b))},showDefaultHeader:function(){this.showLogo({title:"TEMPLATES"});var b=this.getHeaderView();b.tools.show(new a.Views.Actions),b.menuArea.show(new a.Views.Menu)},showPreviewView:function(c){var b=this.getHeaderView();b.menuArea.show(new a.Views.ResponsiveMenu),b.logoArea.show(new a.Views.BackButton),b.tools.show(new a.Views.InsertWrapper({model:c})),this.modalContent.show(new a.Views.Preview({url:c.get("url")}))},showTemplatesView:function(b){this.showDefaultHeader(),this.modalContent.show(new a.Views.TemplateCollection({collection:b}))}}),a.Manager=function(){function b(){var a=c(this).closest(".elementor-top-section"),f=a.data("id"),b=d.documents.getCurrent().container.children,e=a.prev(".elementor-add-section");b&&_.each(b,function(a,b){f===a.id&&(k.atIndex=b)}),e.find(".elementor-add-xpro-button").length||e.find(l).before(m)}function e(a,b){b.addClass("elementor-active").siblings().removeClass("elementor-active");var d=n[a]||n.desktop;c(".xproTemplateLibrary__preview").css("width",d)}var f,g,h,i,j,k=this,l=".elementor-add-new-section .elementor-add-section-drag-title",m='<div class="elementor-add-section-area-button elementor-add-xpro-button"> <i class="xi xi-xpro"></i> </div>',n={desktop:"100%",tab:"680px",mobile:"360px"};this.atIndex=-1,this.channels={tabs:Backbone.Radio.channel("tabs"),templates:Backbone.Radio.channel("templates")},this.updateBlocksView=function(){k.setFilter("tags","",!0),k.setFilter("text","",!0),k.getModal().showTemplatesView(i)},this.setFilter=function(a,b,c){k.channels.templates.reply("filter:"+a,b),c||k.channels.templates.trigger("filter:change")},this.getFilter=function(a){return k.channels.templates.request("filter:"+a)},this.getFilterTerms=function(){return{tags:{callback:function(a){return _.any(this.get("tags"),function(b){return b.indexOf(a)>=0})}},text:{callback:function(a){return a=a.toLowerCase(),this.get("title").toLowerCase().indexOf(a)>=0||_.any(this.get("tags"),function(b){return b.indexOf(a)>=0})}},type:{callback:function(a){return this.get("type")===a}}}},this.showModal=function(){k.getModal().showModal(),k.showTemplatesView()},this.closeModal=function(){this.getModal().hideModal()},this.getModal=function(){return f||(f=new a.Modal),f},this.init=function(){k.setFilter("type","section",!0),d.on("preview:loaded",(function(){var a=window.elementor.$previewContents,c=setInterval(function(){var d,e;(e=(d=a).find(l)).length&&!d.find(".elementor-add-xpro-button").length&&e.before(m),d.on("click.onAddElement",".elementor-editor-section-settings .elementor-editor-element-add",b),a.find(".elementor-add-new-section").length>0&&clearInterval(c)},100);a.on("click.onAddTemplateButton",".elementor-add-xpro-button",k.showModal.bind(k)),this.channels.tabs.on("change:device",e)}).bind(this))},this.getTabs=function(){var b=this.getFilter("type"),a={section:{title:"Blocks"},page:{title:"Pages"}};return _.each(a,function(d,c){b===c&&(a[b].active=!0)}),{tabs:a}},this.getTags=function(){return g},this.getTypeTags=function(){return h[k.getFilter("type")]},this.showTemplatesView=function(){k.setFilter("tags","",!0),k.setFilter("text","",!0),i?k.getModal().showTemplatesView(i):k.loadTemplates(function(){k.getModal().showTemplatesView(i)})},this.showPreviewView=function(a){k.getModal().showPreviewView(a)},this.loadTemplates=function(a){k.requestLibraryData({onBeforeUpdate:k.getModal().showLoadingView.bind(k.getModal()),onUpdate:function(){k.getModal().hideLoadingView(),a&&a()}})},this.requestLibraryData=function(b){if(!i||b.forceUpdate){b.onBeforeUpdate&&b.onBeforeUpdate();var c={data:{},success:function(c){i=new a.Collections.Template(c.templates),c.tags&&(g=c.tags),c.type_tags&&(h=c.type_tags),b.onUpdate&&b.onUpdate()}};b.forceSync&&(c.data.sync=!0),elementorCommon.ajax.addRequest("get_xpro_elementor_library_data",c)}else b.onUpdate&&b.onUpdate()},this.requestTemplateData=function(a,b){var c={unique_id:a,data:{edit_mode:!0,display:!0,template_id:a}};b&&jQuery.extend(!0,c,b),elementorCommon.ajax.addRequest("get_xpro_elementor_template_data",c)},this.insertTemplate=function(b){var c=b.model,a=this;a.getModal().showLoadingView(),a.requestTemplateData(c.get("template_id"),{success:function(d){a.getModal().hideLoadingView(),a.getModal().hideModal();var b={};-1!==a.atIndex&&(b.at=a.atIndex),$e.run("document/elements/import",{model:c,data:d,options:b}),a.atIndex=-1},error:function(b){a.showErrorDialog(b)},complete:function(b){a.getModal().hideLoadingView(),window.elementor.$previewContents.find(".elementor-add-section .elementor-add-section-close").click()}})},this.showErrorDialog=function(a){if("object"===_typeof(a)){var b="";_.each(a,function(a){b+="<div>"+a.message+".</div>"}),a=b}else a?a+=".":a="<i>&#60;The error message is empty&#62;</i>";k.getErrorDialog().setMessage('The following error(s) occurred while processing the request:<div id="elementor-template-library-error-info">'+a+"</div>").show()},this.getErrorDialog=function(){return j||(j=elementorCommon.dialogsManager.createWidget("alert",{id:"elementor-template-library-error-dialog",headerMessage:"An error occurred"})),j}},b.library=new a.Manager,b.library.init(),window.xpro=b}(jQuery,window.elementor,window.xpro||{})